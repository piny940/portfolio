## 目次
[1. はじめに](#1-はじめに)  
[2. 作ったアプリについて](#2-作ったアプリについて)  
[3. 開発の流れ](#3-開発の流れ)  
[4. プロジェクトを通して学んだこと](#4-プロジェクトを通して学んだこと)  

## 1. はじめに
Vtuberが歌枠で歌った曲を検索できる歌枠データベースを制作したのでその記録を記します。

作成したアプリはこちらのリンクから見ることができます。  
https://song-list.piny940.com

## 2. 作ったアプリについて
[2-1 アプリの概要](#2-1-アプリの概要)  
[2-2 アプリの3つの特徴](#2-2-アプリの3つの特徴)  
[2-3 アプリの画面](#2-3-アプリの画面)  
[2-4 アプリの基本操作](#2-4-アプリの基本操作)  

### 2-1 アプリの概要
各チャンネルごとに、今までに歌った曲の一覧を見ることができるようになっています。
曲名と歌手名で検索をする他、詳細検索からは配信日や配信のタイトル名で絞り込むことができるようになっています。

![アプリ画面](https://i.gyazo.com/793fa3a35862f587205e1cc397bb40ac.png)

### 2-2 アプリの3つの特徴
#### 1. メンテナンスフリー
本アプリでは、YoutubeAPIを用いて動画のコメント欄を取得し、OpenAIを用いて解析を行うことで、
配信で歌った曲のデータベースが自動で更新されるようにしています。

Youtubeの配信のコメント欄で、配信で歌われた曲(セトリ)を書いてくれている人がいるため、そのコメントを解析することで新しいセトリのデータが入るようにします。

詳細な手順は以下の通りです。

1. cron jobがRailsのrakeタスクを叩く
2. YoutubeAPIから新しい動画を取得
3. YoutubeAPIからコメントを取得
4. OpenAIでコメントを解析→歌った曲をjsonとして取得
5. 更新したデータを反映


<img src="https://i.gyazo.com/4e5a0d326b7e7f6a49e6dc15c3f0c316.png" alt="構成図" class="custom" width="400">

さらに、OpenAIでの解析はしばしば誤りが含まれていることがあるため、有志のユーザーがセトリを
修正できる仕組みも搭載しています。歌情報の**変更履歴**を保存しておくことで、誤った情報を入力したユーザーがいても簡単に修正ができるようにしました。

![メンテナンス画面](https://i.gyazo.com/9150ffaf77f47ccd2a657c66da185d33.png)

#### 2. 詳細な検索が可能
曲のタイトル名・歌手名に加え、配信日や配信のタイトルで絞り込みができるようにしました。  
これによって探したい曲を素早く見つけることができます。

![詳細検索フォーム](https://i.gyazo.com/c837209fa1cce8ee4ab9f112c51bb77d.png)

#### 3. レスポンシブデザイン  
本アプリはパソコンだけでなくスマートフォンからも見やすいUIを提供することにこだわりました。

既存の歌枠データベースはスプレッドシートで管理しているものが多く、スプレッドシートではスマートフォンから使うことができないという問題がありました。  
レスポンシブなデザインにすることで、スマホからでも気軽に検索ができるようにしました。

<img src="https://i.gyazo.com/7a464c7053e69409e09279d9e3cc3d1d.png" alt="スマートフォンの画面" class="custom" width="400">

### 2-3 アプリの画面
- スタート画面
NewGameを押すと新規データで、Continueを押すと前回遊んだ続きからプレイできます。  
How To Playを押すと遊び方や操作方法が確認できます。  
<img src="https://i.gyazo.com/2ab8c60197a182b3acc1175f44377606.png" alt="スタート画面" width="400" class="custom" />

- メニュー画面
<img src="https://i.gyazo.com/fe4ef5aead20f877909302a5a527f5ee.png" alt="メニュー画面" width="400" class="custom" />

- 装備選択画面
バトルで使用する武器を選択・強化できます。  
<img src="https://i.gyazo.com/e0ad198b17761fe07ad3f9201572a692.png" alt="装備選択画面" width="400" class="custom" />

- ステージ選択画面
<img src="https://i.gyazo.com/9970d0b5e741efa8433e26f4e4e78882.png" alt="ステージ選択画面" width=400 class="custom" />

- アプリ画面
<img src="https://i.gyazo.com/62ee8870988c8add88617e252f12e02d.png" alt="アプリ画面" width="400" class="custom" />

### 2-4 アプリの基本操作
| 名称 | 操作 |
| ---- | ---- |
|上下左右の移動|W + A + S + D|
|武器の使用|左クリック|
|必殺技(ボム)|スペース|
|防御(シールド)|右クリック(長押し)|
|メイン武器とサブ武器の切り替え|マウスホイール|
|一時停止|Escキー|


## 3. 開発の流れ
2021年5月〜11月で要件定義・開発を行いました。

|時期|内容|
|--|--|
|5月|要件定義・仕様書作成|
|6月・7月|開発|
|8月|大規模なリファクタリング|
|9月〜10月|開発|
|11月|最終調整|

プログラマ・グラフィック・音担当の合計10人ほどのチームで開発を行い、私はこのチームのチームリーダーを努めました。具体的には、会議での司会進行・仕様書作成・リファクタリング・コア部分の作成を担当しました。

## 4. プロジェクトを通して学んだこと
**1. オブジェクト指向・MVCの設計**  
私はこのアプリを開発した頃まだまだ未熟で、1000行以上ある、いわゆる神クラスを作ってしまったり、Viewとロジックを密結合にしたりしてしまいました。

見かねた上級生の先輩に、コードが読みにくいと指摘され、クラスが密結合だと良くないということだとか、テストが書きやすいコードの書き方だとかを教えてもらい、8月に大規模なリファクタを行い、ロジックとViewが分離されたコードへと修正しました。

この経験のおかげで、RailsのMVCの考え方をすんなり受け入れることができ、この先のプログラミングの勉強にとても役に立ちました。

**2. チーム開発の基礎**  
当時私はGitやGithubの使い方を全く知りませんでした。  
どれくらい知らなかったかと言うと、
- コミットの単位
- ブランチの切り方
- PRの切り方
- コードレビューの仕方
- Issueの割り振り方

という本当に基本的なことすら分かっていませんでした。

この開発を通して、上級生の人たちにGitの使い方を教えてもらった経験は、この先アルバイトや個人開発でGitを使う際にとても役に立ちました。
