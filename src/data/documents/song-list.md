## 目次
[1. はじめに](#1-はじめに)  
[2. 作ったアプリについて](#2-作ったアプリについて)  
[3. 開発の流れ](#3-開発の流れ)  
[4. プロジェクトを通して学んだこと](#4-プロジェクトを通して学んだこと)  

## 1. はじめに
Vtuberが歌枠で歌った曲を検索できる歌枠データベースを制作したのでその記録を記します。

作成したアプリはこちらのリンクから見ることができます。  
https://song-list.piny940.com

## 2. 作ったアプリについて
[2-1 アプリの概要](#2-1-アプリの概要)  
[2-2 アプリの3つの特徴](#2-2-アプリの3つの特徴)  
[2-3 アプリの画面](#2-3-アプリの画面)  

### 2-1 アプリの概要
各チャンネルごとに、今までに歌った曲の一覧を見ることができるようになっています。
曲名と歌手名で検索をする他、詳細検索からは配信日や配信のタイトル名で絞り込むことができるようになっています。

![アプリ画面](https://i.gyazo.com/793fa3a35862f587205e1cc397bb40ac.png)

### 2-2 アプリの3つの特徴
#### 1. メンテナンスフリー
本アプリでは、YoutubeAPIを用いて動画のコメント欄を取得し、OpenAIを用いて解析を行うことで、
配信で歌った曲のデータベースが自動で更新されるようにしています。

Youtubeの配信のコメント欄で、配信で歌われた曲(セトリ)を書いてくれている人がいるため、そのコメントを解析することで新しいセトリのデータが入るようにします。

詳細な手順は以下の通りです。

1. cron jobがRailsのrakeタスクを叩く
2. YoutubeAPIから新しい動画を取得
3. YoutubeAPIからコメントを取得
4. OpenAIでコメントを解析→歌った曲をjsonとして取得
5. 更新したデータを反映


<img src="https://i.gyazo.com/4e5a0d326b7e7f6a49e6dc15c3f0c316.png" alt="構成図" class="custom" width="400">

さらに、OpenAIでの解析はしばしば誤りが含まれていることがあるため、有志のユーザーがセトリを
修正できる仕組みも搭載しています。歌情報の**変更履歴**を保存しておくことで、誤った情報を入力したユーザーがいても簡単に修正ができるようにしました。

![メンテナンス画面](https://i.gyazo.com/9150ffaf77f47ccd2a657c66da185d33.png)

#### 2. 詳細な検索が可能
曲のタイトル名・歌手名に加え、配信日や配信のタイトルで絞り込みができるようにしました。  
これによって探したい曲を素早く見つけることができます。

<img src="https://i.gyazo.com/c837209fa1cce8ee4ab9f112c51bb77d.png" alt="詳細検索フォーム" width="400" class="custom">

#### 3. レスポンシブデザイン  
本アプリはパソコンだけでなくスマートフォンからも見やすいUIを提供することにこだわりました。

既存の歌枠データベースはスプレッドシートで管理しているものが多く、スプレッドシートではスマートフォンから使うことができないという問題がありました。  
レスポンシブなデザインにすることで、スマホからでも気軽に検索ができるようにしました。

<img src="https://i.gyazo.com/7a464c7053e69409e09279d9e3cc3d1d.png" alt="スマートフォンの画面" class="custom" width="400">

### 2-3 アプリの画面
- トップページ
チャンネルを選択します。

<img src="https://i.gyazo.com/33e373b4aa20416f047191f597f73f34.png" alt="トップページ" width="500" class="custom">

- チャンネル画面  
選択したチャンネルについて見ることができます。

左側にはこれまでに歌った曲の一覧が表示されます。検索欄には**タイトル/歌手名**を入力して絞り込みをします。  

右側にはこれまでの歌枠の一覧が表示されます。動画を選択すると、その動画の中で歌われた曲の一覧を見ることができます。
![チャンネル画面](https://i.gyazo.com/3b91db481cfd4a50a79f925c44218683.png)
![動画を選択したチャンネル画面](https://i.gyazo.com/0158d7c73bc8171793315101a4327cef.png)

- メンテナンス画面  
左側から歌を1つ選択すると、その歌が歌われた時間・タイトル名・歌手名を編集できるようになっています。

編集フォームにはこれまでの修正履歴が表示されており、誤った情報が登録された場合は過去の状態に簡単に戻せるようになっています。
![メンテナンス画面](https://i.gyazo.com/ab542c917b79679ada00b4a4f225f7a1.png)

## 3. 開発の流れ
2021年5月〜11月で要件定義・開発を行いました。

|時期|内容|
|--|--|
|5月|要件定義・仕様書作成|
|6月・7月|開発|
|8月|大規模なリファクタリング|
|9月〜10月|開発|
|11月|最終調整|

プログラマ・グラフィック・音担当の合計10人ほどのチームで開発を行い、私はこのチームのチームリーダーを努めました。具体的には、会議での司会進行・仕様書作成・リファクタリング・コア部分の作成を担当しました。

## 4. プロジェクトを通して学んだこと
**1. オブジェクト指向・MVCの設計**  
私はこのアプリを開発した頃まだまだ未熟で、1000行以上ある、いわゆる神クラスを作ってしまったり、Viewとロジックを密結合にしたりしてしまいました。

見かねた上級生の先輩に、コードが読みにくいと指摘され、クラスが密結合だと良くないということだとか、テストが書きやすいコードの書き方だとかを教えてもらい、8月に大規模なリファクタを行い、ロジックとViewが分離されたコードへと修正しました。

この経験のおかげで、RailsのMVCの考え方をすんなり受け入れることができ、この先のプログラミングの勉強にとても役に立ちました。

**2. チーム開発の基礎**  
当時私はGitやGithubの使い方を全く知りませんでした。  
どれくらい知らなかったかと言うと、
- コミットの単位
- ブランチの切り方
- PRの切り方
- コードレビューの仕方
- Issueの割り振り方

という本当に基本的なことすら分かっていませんでした。

この開発を通して、上級生の人たちにGitの使い方を教えてもらった経験は、この先アルバイトや個人開発でGitを使う際にとても役に立ちました。
